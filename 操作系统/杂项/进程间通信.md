### 进程间通信(IPC)的方式

进程间通信主要包括管道、系统IPC（包括消息队列、信号量、信号、共享内存等）、以及套接字socket。

##### 1.管道：

管道主要包括无名管道和命名管道:管道可用于具有亲缘关系的父子进程间的通信，有名管道除了具有管道所具有的功能外，它还允许无亲缘关系进程间的通信

普通管道只能用于父子进程或兄弟进程间的通信，因为普通管道通过fork调用来拷贝文件描述符的，在文件系统中，普通管道并不对应物理文件。
命名管道在文件系统中有物理文件存在，因此可以用于非亲属的进程间通信。

**1.1 普通管道PIPE：**

1)它是半双工的（即数据只能在一个方向上流动），具有固定的读端和写端

2)它只能用于具有亲缘关系的进程之间的通信（也是父子进程或者兄弟进程之间），访问的进程终止时，随之撤销

3)它可以看成是一种特殊的文件，对于它的读写也可以使用普通的read、write等函数。但是它不是普通的文件，并不属于其他任何文件系统，并且**只存在于内存中**。

4)命令管道遵守FIFO先进先出

**1.2 命名管道FIFO：**

1)它是半双工的（即数据只能在一个方向上流动），具有固定的读端和写端

2)FIFO可以在无关的进程之间交换数据

3)FIFO有路径名与之相关联，它以一种特殊设备文件形式**存在于文件系统中**。

创建普通管道，PIPE()

创建有名管道，MKNOD()

读写操作，WEITE()和READ()

关闭管道，CLOSE()

##### 2.系统IPC：

**2.1 消息队列**

消息队列，是消息的链接表，存放在内核中。一个消息队列由一个标识符（即队列ID）来标记。 (消息队列克服了信号传递信息少，管道只能承载无格式字节流以及缓冲区大小受限等特点)具有写权限的进程可以按照一定的规则向消息队列中添加新信息；对消息队列有读权限得进程则可以从消息队列中读取信息；

特点：

1)消息队列是面向记录的，其中的消息具有**特定的格式**以及特定的优先级。

2)消息队列**独立**于发送与接收进程。进程终止时，消息队列及其内容并不会被删除。

3)消息队列可以实现消息的**随机查询**,消息不一定要以先进先出的次序读取,也可以按消息的类型读取。

创建消息队列，MSGGET()

发送和接收消息，MSGSND()和MSGRCV()

改变队列的使用权限和其他一些特性，MSGCTL()

**2.2 信号量semaphore**

信号量（semaphore）与已经介绍过的 IPC 结构不同，它是一个**计数器**，可以用来控制多个进程对**共享资源**的访问。信号量用于实现进程间的**互斥与同步**，而不是用于存储进程间通信数据。

特点：

1)信号量用于进程间同步，若要在进程间传递数据需要结合共享内存。

2)信号量基于操作系统的 PV 操作(P表示通过的意思，s-1；V表示释放的意思，s+1)，程序对信号量的操作都是原子操作。

3)每次对信号量的 PV 操作不仅限于对信号量值加 1 或减 1，而且可以加减任意正整数。

4)支持信号量组。

**2.3 信号signal**

信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生。

**2.4 共享内存（Shared Memory）**

它使得多个进程可以访问**同一块内存空间**，不同进程可以及时看到对方进程中对共享内存中数据得更新。这种方式需要依靠某种同步操作，如互斥锁和信号量等

特点：

1)共享内存是最快的一种IPC，因为进程是直接对内存进行存取

2)因为多个进程可以同时操作，所以需要进行同步

3)**信号量+共享内存**通常结合在一起使用，信号量用来同步对共享内存的访问

##### 3.套接字SOCKET：

socket也是一种进程间通信机制，与其他通信机制不同的是，它可用于**不同主机之间的进程通信**。

### 线程间通信的方式

##### 临界区：

通过多线程的串行化来访问公共资源或一段代码，速度快，适合控制数据访问；

##### 互斥量Synchronized/Lock：

采用互斥对象机制，只有拥有互斥对象的线程才有访问公共资源的权限。因为互斥对象只有一个，所以可以保证公共资源不会被多个线程同时访问

##### 信号量Semphare：

为控制具有有限数量的用户资源而设计的，它允许多个线程在同一时刻去访问同一个资源，但一般需要限制同一时刻访问此资源的最大线程数目。

##### 事件(信号)，Wait/Notify：

通过通知操作的方式来保持多线程同步，还可以方便的实现多线程优先级的比较操作

### 消息队列和管道的区别

1. 消息队列是格式字节流，管道是无格式字节流
2. 消息是有类型的，在实际应用中，可作为优先级使用；管道内数据无类型
3. 消息队列可以在不同进程间使用，普通管道只能在亲属进程间使用
4. 消息队列存放在内核中，而队列存于内存或者磁盘上，前者随内核持续，后者随进程持续
5. 消息队列独立于收发进程而存在，从而消除了在同步命名管道的打开和关闭时可能产生的困难。
6. 消息队列可以随机查询，而管道只能先进先出

### 共享内存比管道和消息队列效率高的原因

共享内存区是最快的可用IPC形式，一旦这样的内存区映射到共享它的进程的地址空间，这些进程间数据的传递就不再通过执行任何进入内核的系统调用来传递彼此的数据，节省了时间。

共享内存和消息队列，FIFO，管道传递消息的区别：
  后者，消息队列，FIFO，管道的消息传递方式一般为
  1：服务器得到输入
  2：通过管道，消息队列写入数据，通常需要从进程拷贝到内核。
  3：客户从内核拷贝到进程
  4：然后再从进程中拷贝到输出文件
  上述过程通常要经过4次拷贝，才能完成文件的传递。
  而共享内存只需要
  1:从输入文件到共享内存区
  2:从共享内存区输出到文件
  上述过程不涉及到内核的拷贝，所以花的时间较少。

因为系统内核没有对访问共享内存进行同步，您必须提供自己的同步措施。例如，在数据被写入之前不允许进程从共享内存中读取信息、不允许两个进程同时向同一个共享内存地址写入数据等。解决这些问题的常用方法是通过使用信号量进行同步。